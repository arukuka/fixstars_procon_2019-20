# 素数大貧民ノート

## 触ってみて

- akemi 同士の対戦では山場のカードがなくなるのが先で、手札が結構余る
	```
	PS C:\msys64\home\capri_000\fixstars_contest_2020> python .\prime_daihinmin.py A .\akemi.exe B .\akemi.exe C .\akemi.exe D .\akemi.exe --time 30
	players: A, B, C, D
	stock: 2205
	time limit: 30.0
	No stock
	1 : D 270 OK 6.623
	2 : A 352 OK 1.819
	3 : C 383 OK 0.485
	4 : B 407 OK 1.003
	stock: 0
	time (s): 115.902
	```
- まずは戦略的なことを考えず、たくさん手札を消せるようにした方が良さそう
	- 手札が 0 になりそうになったらまた考える

## 手札を少なくするには

- 戦略的でもあるができるだけ自分が親になれると良い
- ベルフェカットができるならする
- メルセンヌカットができるならする
- マックスカット: 自分が親のとき、桁の中で最大の素数を出せば親になれる
	```
	7
	97
	997
	9973
	99991
	```
- 自分の手番のとき、枚数の多い数字を上位桁に持っていくことで優先的に使うようにする
	- 素数探索の上で参考になるもの
		- ルジャンドル予想: n^2 ~ (n+1)^2 の間に必ず素数が存在するという予想(未解決)
		- 十分大きな x について、区間 [x, x + O(x^(21/40))] は必ず素数を含むということが証明されている
	- とりあえず優先的に桁を消費した後の数を x としたとき [x, x + \sqrt(x)] まで探せばよいか？
		```cpp
		int v = x;
		int ans = 0;
		for (;;)
		{
			y = v - x;
			if (y * y > x) {
				break;
			}
			if (len(str(v)) > len(str(x))) {
				break;
			}
			if (is_prime(v)) {
				ans = v;
				break;
			}
			++v;
		}
		```
	- x が小さければ予想を信じて [x, 2x + 1] まで探索するので良さそう
	- 時間が足りなそうであれば pass する
- 2 手目のときだけ例外にして +1 した数から同じ桁で素数を探索して、枚数の多い数字が使われたらポイント高くする、とする。

## e6f9467b08f01c987b630a72b6f1bda22d1337ab

- 初期バージョン
- akemi さんには勝てます
- akemi さん x2 と自分の x2 の結果(制限時間 50s)
	```
	play: arukuka0 00000012222222224444444444444444444444444444444444444456666666666666666666 (757,863) [OK]
	pass: arukuka1 0000000000000000000022222222222222244444444444444444444444444444444444444444466666666666888899 (757,863) [PASSED]
	...
	1 : arukuka0 74 OK 49.071
	2 : arukuka1 94 OK 48.897
	3 : akemi0 513 OK 12.105
	4 : akemi1 560 OK 11.155
	```
- 雑感
	- 2 桁までは削れるようになった(嬉しい)
	- 偶数がとても残ってしまっている
	- 終盤一桁メルセンヌカットをぶっぱしてる
	- 意外と時間が余っている
- これから
	- 次状態の評価、行動評価が必要そう
	- ベルフェカットも予約だけしておいて、以下のシチュエーションで出せば有利
		- 出せなくなったとき
		- 勝ち確になったとき
	- 親の手番で一桁で出せば 1 周何事もなく回ると 8 桁で回ってくる
		- 16 桁を出すのは難しいと思うので強そう
	- 何桁まで計算が可能が調べておきたい
- 次状態の評価
	- まずはこれをやると良いと思う
	- 係数探索を optuna で自動化してみたいが後回し
	- 最小化する
	- 奇数が偶数の枚数を下回ったら大幅加点
	- 持っているカード毎に加点
		- 基本偶数>奇数
		- 奇数
			- 5: 素数だが二桁以上下一桁になったら最弱。早めに使いきりたい
			- 1, 9: 素数ではないが使い道はある
			- 3, 7: 最強奇数
				- 3と7だけになって親なら勝ち確
		- 偶数
			- 2: 素数
			- 4, 6, 8: 甲乙つけがたいが弱い
				- ↑の対戦結果を見るに 4>6>8 (4が最弱に見える)
